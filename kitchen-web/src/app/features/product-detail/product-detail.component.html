<section class="product-detail-container">
  <button class="btn-back" (click)="goBack()">&#8592; Voltar</button>

  <ng-container *ngIf="product; else notFound">
    <header class="product-header">
      <div class="product-image-wrapper">
        <img [src]="product.imageUrl" [alt]="product.name" class="product-main-image" />
      </div>

      <article class="product-info">
        <h1 class="product-name-detail">{{ product.name }}</h1>

        <div class="product-meta">
          <p><strong>Categoria:</strong> {{ product.category.name }}</p>
          <p><strong>Catálogo:</strong> {{ product.catalog.name }}</p>
        </div>

        <p class="product-description">{{ product.description }}</p>

        <div class="product-price-detail">
          <span *ngIf="selectedSku; else price">
            {{ selectedSku.price | currencyFormatter}}
          </span>
          <ng-template #price>
            {{ product.basePrice | currencyFormatter }}
          </ng-template>
        </div>

        <section *ngIf="product.skus!.length" class="sku-selection">
          <h2>Variações Disponíveis</h2>
          <div class="sku-list">
            <article *ngFor="let sku of product.skus"
                     class="sku-card"
                     [class.selected]="selectedSku === sku"
                     (click)="selectSku(sku)">
              <div class="sku-attributes">
                <span *ngIf="getAttributeValue(sku, 'Cor')">
                  Cor: <strong>{{ getAttributeValue(sku, 'Cor') }}</strong>
                </span>
                <span *ngIf="getAttributeValue(sku, 'Tamanho')">
                  Tamanho: <strong>{{ getAttributeValue(sku, 'Tamanho') }}</strong>
                </span>
              </div>

              <div class="sku-stock" [class.out-of-stock]="sku.stock.availableQuantity === 0">
                Em Estoque: {{ sku.stock.availableQuantity }}
                <span *ngIf="sku.stock.availableQuantity === 0" class="out-of-stock-label">
                  (Esgotado)
                </span>
              </div>

              <div class="sku-price">
                {{ sku.price | currencyFormatter }}
              </div>
            </article>
          </div>
        </section>

        <div class="cart-actions">
          <div class="quantity-wrapper">
            <label for="quantity" class="quantity-label">Quantidade:</label>
            <select id="quantity" [(ngModel)]="selectedQuantity" class="quantity-select" [disabled]="selectedSku.stock.availableQuantity === 0">
              <option *ngFor="let qty of [1,2,3,4,5,6,7,8,9,10]" [value]="qty">
                {{ qty }}
              </option>
            </select>
          </div>
          <button class="btn btn-blue add-to-cart-btn"
                  (click)="addToCart()"
                  [disabled]="!selectedSku || availableStock === 0">
            Adicionar ao Carrinho
          </button>
        </div>

        <p *ngIf="availableStock === 0" class="stock-warning">
          Este item está esgotado no momento.
        </p>
      </article>
    </header>
  </ng-container>

  <ng-template #notFound>
    <p class="no-product-found">Produto não encontrado ou não disponível.</p>
  </ng-template>
</section>