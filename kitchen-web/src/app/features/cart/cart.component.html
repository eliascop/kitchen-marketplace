<span *ngIf="currentStep === 1"><button class="btn-step" (click)="goBack()">&#8592; Escolher mais itens</button></span>

<div class="cart-container">
  <h2>Meu carrinho de compra</h2>

  <div class="steps">
    <span [class.active]="currentStep === 1">1. Meu carrinho</span>
    <span [class.active]="currentStep === 2">2. Local de entrega</span>
    <span [class.active]="currentStep === 3">3. Pagamento</span>
    <span [class.active]="currentStep === 4">4. Resumo</span>
  </div>

  <div *ngIf="currentStep === 1">
    <div *ngIf="cart.items.length === 0" class="empty-cart">
      <p>O seu carrinho está vazio.</p>
    </div>

    <div *ngIf="cart.items.length > 0">
      <div class="cart-item-list">
        <div *ngFor="let item of cart.items" class="cart-item">
          <div class="item-details">
            <span class="item-name">{{ item.product.name }}</span>
            <span class="item-quantity">x {{ item.quantity }}</span>
            <span class="item-price">R$ {{ item.value | currencyFormatter}}</span>
            <span class="item-subTotal">R$ {{ (item.value * item.quantity) | currencyFormatter}}</span>
          </div>
          <button class="remove-btn" (click)="onRemoveItem(item.id!)"> <i class="fa fa-trash"></i> </button>
        </div>
        <div class="clear-cart" *ngIf="cart.items.length > 1">
          <button class="clear-btn" (click)="onClearCart()">Limpar Carrinho</button>
        </div>
      </div>

      <div class="cart-summary">
        <h3>Total: R$ {{ cart.cartTotal | currencyFormatter }}</h3>
        <button class="btn-step" (click)="nextStep()">Continuar para meus locais de entrega</button>
      </div>
    </div>
  </div>

  <div *ngIf="currentStep === 2" class="shipping-step">
    <h3>Meus locais de entrega e cobrança:</h3>
    <div class="delivery-options">
      <label *ngFor="let addr of user?.addresses">
        - Endereço de {{addr.type === 'SHIPPING'? 'Entrega' : 'Faturamento'}}: <br>{{addr.zipCode}} - {{ addr.street }}, {{ addr.number }} - {{ addr.city }}/{{ addr.state }}
      </label>
    </div>
  
    <h3>Escolha a forma de entrega para os produtos abaixo: </h3>
    <div class="shipping">
      <div >
        <div class="shipping-options" *ngFor="let ship of cart.shippingMethod; let i = index" >
          <label><strong>{{ ship.seller.storeName }}</strong></label>
      
          <div *ngFor="let option of shippingOptions">
            <label>
              <input type="radio" name="shipping-{{ i }}" [value]="option" [checked]="ship.id === option.id" (change)="selectShipping(ship, option)" />
              {{ option.method }} - R$ {{ option.cost | currencyFormatter }} - {{ option.estimatedDays }} dias
            </label>
          </div>

        </div>
      </div>
      <div class="shipping-frete">
        <div>Total frete: R$ {{shippingTotal | currencyFormatter}}</div>
        <h3>Total do pedido: R$ {{cart.cartTotal +  shippingTotal | currencyFormatter}}</h3>
      </div>
    </div>
    <div class="actions">
      <button class="btn-step" (click)="prevStep()">Voltar</button>
      <button class="btn-confirm" (click)="updateShipping()" [disabled]="!allShippingsSelected()">Continuar para pagamento</button>
    </div>
  </div>
  

  <div *ngIf="currentStep === 3" class="payment-step">
    <h3>Escolha a forma de pagamento</h3>
    <div class="payment-options">
      <label><input type="radio" name="payment" value="pix" [(ngModel)]="paymentMethod"> PIX </label>
      <label><input type="radio" name="payment" value="card" [(ngModel)]="paymentMethod"> Cartão de Crédito </label>
      <label><input type="radio" name="payment" value="paypal" [(ngModel)]="paymentMethod"> Paypal </label>
    </div>

    <div class="actions">
      <button class="btn-step" (click)="prevStep()">Voltar</button>
      <button class="btn-step" (click)="onPaymentSelected()" [disabled]="!paymentMethod">Continuar</button>
    </div>
  </div>

  <div *ngIf="currentStep === 4" class="payment-step">
    <h3>Resumo do pedido</h3>
      <div class="cart-item-list">
        <div *ngFor="let item of cart.items" class="cart-item">
          <div class="item-details">
            <span class="item-name">{{ item.product.name }}</span>
            <span class="item-quantity">x {{ item.quantity }}</span>
            <span class="item-price">R$ {{ item.value | currencyFormatter}}</span>
            <span class="item-subTotal">R$ {{ (item.value * item.quantity) | currencyFormatter}}</span>
          </div>
      </div>
      <div class="resume-box">
        <label *ngFor="let addr of user?.addresses">
          {{addr.type === 'SHIPPING'? 'Entrega' : 'Faturamento'}}: <br>{{addr.zipCode}} - {{ addr.street }}, {{ addr.number }} - {{ addr.city }}/{{ addr.state }}
        </label>
      </div>
      <div class="resume-box">
        <label>Prazo estimado para entrega:</label>
        <label *ngFor="let ship of cart.shippingMethod">
          R$ {{ ship.cost | currencyFormatter }} - {{ ship.carrier }} - {{ ship.estimatedDays }} dias
        </label>
      </div>
      <div class="resume-box">
        <div>Total frete: R$ {{shippingTotal | currencyFormatter}}</div>
        <h3>Total do pedido: R$ {{cart.cartTotal +  shippingTotal | currencyFormatter}}</h3>
      </div>

    <div class="actions">
      <button class="btn-step" (click)="prevStep()">Voltar</button>
      <button class="btn-step" (click)="onCheckout()"><Strong>Finalizar a compra</Strong></button>
    </div>
  </div>
</div>
