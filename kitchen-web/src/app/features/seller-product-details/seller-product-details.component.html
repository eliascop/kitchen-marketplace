<section class="product-detail-page">

    <button class="btn-back" (click)="goBack()">← Voltar</button>
  
    <header class="header">
  
      <div class="info">
        <h1>{{ product.name }}</h1>
  
        <p>{{ product.description }}</p>
        <p><strong>Categoria:</strong> {{ product.category }}</p>
        <p><strong>Catálogo:</strong> {{ product.catalog }}</p>
        <p><strong>Preço base:</strong> R$ {{ product.price | currencyFormatter }}</p>
        <p><strong>Status:</strong> {{ product.productStatus }}</p>
  
        <div class="actions">
          <button class="btn-primary" (click)="editProduct()">Editar Produto</button>
          <button class="btn-secondary" (click)="manageSkus()">Gerenciar SKUs</button>
        </div>
      </div>
  
      <div class="image">
        <img [src]="product.imageUrl" [alt]="product.name" width="250">
      </div>
  
    </header>
  
    <h2>SKUs</h2>
  
    <table class="table-details" *ngIf="product.skus!.length > 0">
      <thead>
        <tr>
          <th>ID</th>
          <th>SKU</th>
          <th>Preço</th>
          <th>Atributos</th>
          <th>Estoque</th>
          <th>Histórico</th>
        </tr>
      </thead>
  
      <tbody>
        <ng-container *ngFor="let sku of product.skus">
  
          <tr>
            <td>{{ sku.id }}</td> 
            <td>{{ sku.sku }}</td>
            <td>R$ {{ sku.price | currencyFormatter }}</td>
  
            <td>
              <ul>
                <li *ngFor="let attr of sku.attributes">
                  {{ attr.attributeName }}: {{ attr.attributeValue }}
                </li>
              </ul>
            </td>
  
            <td>
              Disponível: {{ sku.stock.availableQuantity }}
            </td>
  
            <td class="history-cell">
              <ng-container *ngIf="!sku.stockHistory || sku.stockHistory.length === 0">
                <span>Sem Movimentação</span>
              </ng-container>
  
              <ng-container *ngIf="sku.stockHistory && sku.stockHistory.length > 0">
                <button class="btn-link" (click)="toggleHistory(sku)">
                  {{ sku.expanded ? '▲ Esconder' : '▼ Ver Histórico' }}
                </button>
              </ng-container>
            </td>
          </tr>
  
          <tr *ngIf="sku.expanded && sku.stockHistory && sku.stockHistory.length > 0">
            <td colspan="6">
              <table class="table-details nested">
                <thead>
                  <tr>
                    <th>Data</th>
                    <th>Ação</th>
                    <th>Total</th>
                    <th>Reservado</th>
                    <th>Vendido</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let h of sku.stockHistory">
                    <td>{{ h.createdAt | formatDateTime }}</td>
                    <td>{{ h.eventType | stockStatus }}</td>
                    <td>{{ h.totalQuantity }}</td>
                    <td>{{ h.reservedQuantity }}</td>
                    <td>{{ h.soldQuantity }}</td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tr>
  
        </ng-container>
      </tbody>
    </table>
  
  </section>